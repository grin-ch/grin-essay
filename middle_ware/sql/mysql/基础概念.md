[TOC]

# MySQL概念篇

## MySQL服务端/客户端

mysql分为服务端和客户端，客户端发送命令，服务端负责执行命令和返回结果给客户端

**通信方式**

- TCP/IP： 默认采用的的通信协议
- 命名管道和共享内存： windows下可以使用
- UNIX域套接字： 如果服务端和客户端都运行在类unix的同一台机器，则可以使用这种方式

**服务端**

MySQL的服务端程序安装目录下有个bin目录，里面存放了很多重要的可执行文件

服务端负责处理命令和返回结果

```sh
|--mysql		# mysql客户端程序
|--mysql.server	# mysql启动脚本，会间接调用mysql_safe， 启/停参数 start/stop
|--mysqladmin
|--mysqlbinlog
|--mysqlcheck
|--mysqld		# mysql的服务器进程
|--mysqld_multi	# 用于启动多个mysql服务实例
|--mysqld_safe	# mysql的启动脚本，间接调用mysqld
|--mysqldump
|--mysqlimport
|--mysqlpump
```

**客户端**

客户端用于向服务端发送命令

安装目录下的`bin/mysql`可执行文件就是一个mysql客户端应用

```sh
# 启动命令 mysql -h 主机名 -u 用户名 -p 密码(可以回车后再输入密码)
mysql -h localhost -u root -p
```

## 请求处理流程

**连接管理**

当有客户端连接到服务端时，服务端会创建一个线程用于处理这个客户端的请求

当客户端断开连接时，服务端不会立刻销毁该线程，当有其他客户端请求建立连接时，服务端会复用该线程建立连接

**查询缓存**

mysql会将一个查询的结果缓存，当有相同的查询语句时，可以从缓存中查询结果

但是如果该表的结构被修改或该表执行过INSERT,UPDATE,DELETE等语句，则该表的查询缓存会失效并删除

此外，如果查询语句涉及到部分系统函数(NOW等)和系统表(mysql,information_schema等)或用户自定义的变量/函数，则该查询不会被缓存

由于维护查询缓存的代价十分巨大，**在mysql5.7.20之后开启弃用，8.0后直接删除了此功能**

**语法解析**

如果查询缓存没命中，就要开始真正进入查询阶段了

首先会分析查询语句的语法是否正确，然后再从文本中把要查询的表，各种条件提取出来

**查询优化**

mysql会将查询语句进行一些优化，如外连接转为内连接，表达式简化，子查询转为连接等

然后生成一份执行计划，包括用到的索引，表之间的连接顺序等，可以使用EXPLAIN语句查看执行计划



## 存储引擎

存储引擎（表处理器）负责数据的记录到不同的物理存储器，读取数据等功能

为了方便管理，mysql服务端又分为server层和存储引擎两层

- server层负责连接管理，查询缓存，语法解析，查询优化等不涉及真实数据存取功能的部分
- 存取真实数据的部分划分给存储引擎

不同的存储引擎提供了统一的接口给server调用，server层完成查询优化之后，按照生成的执行计划调用存储引擎就行

通常两层交互时，按照**记录**为单位，以SELECT为例

- server层向存储引擎索要一条记录，当符合where条件时，返回给客户端，否则跳过该记录，然后继续索要下一条记录，以此类推
- server层向客户端发送数据时，会先记录到缓冲区，等缓冲区满了才会真正发给客户端

主要的两种存储引擎

- InnoDB：MySQL5.5.5版本开始作为默认引擎
- MyISAM：Mysql5.5.5以前的默认引擎

---



